<!DOCTYPE html>
<html>

<head>
	<title>Role Detail - <%= role[pathway.id][levelId].title %></title>
	<%- include('_styles') %>
</head>

<body>
	<div class="page">
		<%- include('_nav') %>

		<section class="hero">
			<h1><%= role[pathway.id][levelId].title %></h1>
			<p>
				<span class="badge badge--accent"><%= role.name %></span>
				<span class="badge"><%= pathway.description %></span>
				<span class="badge badge--ok">Level <%= levelId %></span>
			</p>
		</section>

		<% let level = role[pathway.id][levelId] %>

		<div class="grid">
			<% skills.categories.forEach(category=> { %>
				<section class="card">
					<div class="card__body">
						<div class="item-title">
							<div class="item-title__name"><%= category.name %></div>
							<div class="badge"><%= category.id %></div>
						</div>

						<% const categorySkills = (skills.skills || []).filter(skill => skill.category_id === category.id) %>
						<% const competencies = categorySkills.map(skill => ({ skill, competency: level[skill.id] })).filter(x => x.competency != null) %>

						<% if (competencies.length === 0) { %>
							<div style="color: var(--muted); font-size: 13px;">No competencies set for this category at this level.</div>
						<% } %>

						<% competencies.forEach(({ skill, competency }) => { %>
							<% let skillLevel = (skill.levels || []).find(l => l.level == competency) %>
							<% let lev = (skills.levels || []).find(l => l.level == competency) %>
							<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.10);">
								<div class="item-title">
									<div class="item-title__name"><%= skill.name %></div>
									<div class="badge"><%= skill.id %></div>
									<div class="badge badge--ok">Level <%= competency %><% if (lev) { %> â€¢ <%= lev.level_name %><% } %></div>
								</div>
								<% if (skillLevel && skillLevel.brief_description) { %>
									<div style="color: var(--muted); font-size: 13px;"><%= skillLevel.brief_description %></div>
								<% } %>
							</div>
						<% }) %>
					</div>
				</section>
			<% }); %>
		</div>

		<%- include('_footer') %>
	</div>
</body>

</html>
